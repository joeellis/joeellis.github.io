<!DOCTYPE html>
<html>
  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width initial-scale=1">

  <title>Creating IEx shells on Remote Nodes</title>
  <meta name="description" content="Note: --remsh has some security issues you should be aware of when using it on your local machine. Please be sure to read the security section at the bottom ...">

  <link rel="stylesheet" href="/css/main.css">
  <link rel="canonical" href="http://joeellis.la/remote-iex-sessions/">
  <link rel="alternate" type="application/atom+xml" title="joeellis.la" href="http://joeellis.la/feed.xml" />
</head>

  <body>
    <div class="header-container">
  <nav class="site-nav">
    <div class="trigger">
      
        
        <a class="page-link" href="/about/">About</a>
        
      
        
      
        
      
        
      
      <a class="page-link" href="/feed.xml">RSS</a>
    </div>
  </nav>
</div>

      <div class="wrapper">
        <div class="page-content">
          <div class="header-intro">
  <div class="intro-details">
    <div class="intro-photo">
      <a href="http://joeellis.la">
        <img class="avatar-photo" src="/assets/images/avatar.png" width="55" height="55" />
      </a>
    </div>
    <p class="intro-description">
      <a href="http://joeellis.la">My name is Joe Ellis and I am a full stack developer in New Orleans, interested all things Elixir, Ruby, and Javascript.</a>
    </p>
  </div>
</div>
<hr />

<div class="post">
  <header class="post-header">
    <h1 class="post-title">Creating IEx shells on Remote Nodes</h1>
    <p class="post-meta">June 10, 2017</p>
  </header>

  <article class="post-content">
    <p><strong>Note</strong>: <code class="highlighter-rouge">--remsh</code> has some security issues you should be aware of when using it on your local machine. Please be sure to read the <strong>security section</strong> at the bottom of this article.</p>

<p>Recently I learned about a fun option in IEx called <code class="highlighter-rouge">--remsh</code> or “remote shell”. It starts an IEx shell within the context of a running Elixir node and also connects to that node’s cluster, allowing you to debug and reproduce issues within a running application! Also note that despite the name, <code class="highlighter-rouge">--remsh</code> can connect to both local and remote nodes.</p>

<p><code class="highlighter-rouge">--remsh</code> works in combination with two options, <code class="highlighter-rouge">--name</code> and <code class="highlighter-rouge">--cookie</code>. The first option creates a named IEx shell to identify yourself to other running nodes, and the second option is <a href="http://erlang.org/doc/reference_manual/distributed.html#id88372">the security cookie</a> needed to access the node (often found under your home directory at <code class="highlighter-rouge">~/.erlang.cookie</code>).</p>

<p>To create a remote shell, run IEx like this:</p>

<figure class="highlight"><pre><code class="language-shell" data-lang="shell"><span class="c"># when running Elixir app on a server called example.com...</span>
<span class="gp">&gt; </span>iex --name <span class="s2">"joe@iex_test"</span> --cookie secret_cookie --remsh <span class="s2">"node@example.com"</span>

iex<span class="o">(</span>node@example.com<span class="o">)</span>1&gt;</code></pre></figure>

<p>And you’re in! You can see your named shell by running <code class="highlighter-rouge">Node.list</code>:</p>

<figure class="highlight"><pre><code class="language-shell" data-lang="shell"><span class="gp">iex(node@example.com)1&gt; </span>Node.list
<span class="o">[</span>:joe@iex_test]</code></pre></figure>

<p>You could even wrap this up in a simple bash script to make it easier to use:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="k">function </span>reiex<span class="o">()</span> <span class="o">{</span>
 <span class="k">if</span> <span class="o">[</span> <span class="nv">$1</span> <span class="o">=</span> <span class="s2">"staging"</span> <span class="o">]</span>; <span class="k">then
  </span>iex --name <span class="s2">"</span><span class="k">$(</span>whoami<span class="k">)</span><span class="s2">@reiex"</span> --cookie secret_cookie --remsh <span class="s2">"node@staging.example.com"</span>
 <span class="k">elif</span> <span class="o">[</span> <span class="nv">$1</span> <span class="o">=</span> <span class="s2">"prod"</span> <span class="o">]</span>; <span class="k">then
  </span>iex --name <span class="s2">"</span><span class="k">$(</span>whoami<span class="k">)</span><span class="s2">@reiex"</span> --cookie secret_cookie --remsh <span class="s2">"node@prod.example.com"</span>
 <span class="k">else
  </span><span class="nb">echo</span> <span class="s2">"Environment not found!"</span>
 <span class="k">fi</span>
<span class="o">}</span></code></pre></figure>

<p>This way you can connect to a running instance anytime by doing <code class="highlighter-rouge">reiex staging</code>, etc. Very cool!</p>

<h4 id="security-issues">Security Issues</h4>

<p><code class="highlighter-rouge">--remsh</code> has security implications you should be aware of before using it. Remember - Elixir / Erlang nodes have complete access to all other nodes in a given cluster. So when you connect from your laptop via <code class="highlighter-rouge">--remsh</code>, other nodes in that cluster <strong>can now access and make RPC calls on your local workstation</strong>! If you connect to a compromised node from your local machine, your private files (even private SSH keys) would be up for grabs.</p>

<p>If you plan to do any serious work with remsh, I recommend reading Alex Weber’s <a href="https://broot.ca/erlang-remsh-is-dangerous">writeup</a> which goes in further detail about this issue. Alex also offers us a more secure alternative: create an SSH connection to your remote machine first and <code class="highlighter-rouge">remsh</code> locally to the node from there. This can at least prevent node RPC calls from being made against your workstation as well as establish a more secure connection between your machine and the node.</p>

<p>Happy <code class="highlighter-rouge">--remsh</code>-ing everyone!</p>

  </article>

  <hr>

  <div class="question">
    <a class="twitter-follow-button" href="https://twitter.com/notjoeellis" data-show-count="true" data-size="large">
      Follow @notjoeellis
    </a>
    <script type="text/javascript">
      window.twttr = (function (d, s, id) {
        var t, js, fjs = d.getElementsByTagName(s)[0];
        if (d.getElementById(id)) return;
        js = d.createElement(s); js.id = id;
        js.src= "https://platform.twitter.com/widgets.js";
        fjs.parentNode.insertBefore(js, fjs);
        return window.twttr || (t = { _e: [], ready: function (f) { t._e.push(f) } });
      }(document, "script", "twitter-wjs"));
    </script>
  </div>

  <!--<div class="related">
    <h2>Related</h2>
    
      <li><a href="/streaming-with-ecto/" title="Streaming Data with Ecto">Streaming Data with Ecto
       &nbsp; <span class="post-meta">May 21, 2017</span></a>
    
      <li><a href="/elixir-nested-modules/" title="Nested Modules and Auto-Aliasing in Elixir">Nested Modules and Auto-Aliasing in Elixir
       &nbsp; <span class="post-meta">May 10, 2017</span></a>
    
  </div>-->

</div>

        </div>
        <footer class="site-footer">
  <p class="small">joeellis.la &copy; 2017</p>
</footer>

    </div>
  </body>

  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-99074897-1', 'auto');
    ga('send', 'pageview');

  </script>
</html>
